{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { ThemeProvider } from \"styled-components\";\nimport Head from \"next/head\";\nimport Router, { useRouter } from \"next/router\";\nimport Link from \"next/link\"; // import { motion, AnimatePresence } from \"framer-motion\";\n\nimport React, { useEffect } from \"react\";\nimport LightTheme from \"../styles/theme/light\";\nimport DarkTheme from \"../styles/theme/dark\";\nimport useMedia from \"use-media\";\nimport styled from \"styled-components\"; // import nextCookies from \"next-cookies\";\n\nimport { useCookies } from \"react-cookie\";\nimport About from \"./about\";\nimport AuthenticatedApp from \"./authenticated\";\nimport HandleRedirect from \"./handle_redirect/index\";\nimport GlobalStyle from \"../styles/global\";\nimport { asyncFetch } from \"../components/fetchHelper\"; // Import CSS\n\nimport \"normalize.css\";\nimport \"../assets/fonts/inter.css\";\nimport \"../styles/index.css\";\nconst config = {\n  apiKey: \"AIzaSyAT-v8o3B_cYtmaQOcOAaZypeXQC4W1lH8\",\n  authDomain: \"banana-dd8f3.firebaseapp.com\",\n  databaseURL: \"https://banana-dd8f3.firebaseio.com\",\n  projectId: \"banana-dd8f3\",\n  storageBucket: \"banana-dd8f3.appspot.com\",\n  messagingSenderId: \"33006064885\"\n}; // function MyApp({ Component, pageProps }) {\n// const mediaDarkMode = useMedia(\"(prefers-color-scheme: dark)\");\n// const [cookies, setCookie] = useCookies([]);\n//   let currentTime = Date.now() / 1000;\n//   let access_token = cookies.access_token;\n//   let expires_at = cookies.expires_at;\n//   // let refresh_token = cookies.refresh_token;\n//   React.useEffect(() => {\n//     if (access_token && expires_at > currentTime) {\n//       console.log(\"APP.JS: user is authenticated\");\n//       // If there is an access token and it hasn't expired, user is authenticated\n//     } else {\n//       // If none of the above, there is no authenticated user\n//       console.log(\"APP.JS: There is no authenticated user\");\n//       Router.push(\"/\");\n//     }\n//   }, []);\n//   return (\n// <ThemeProvider theme={mediaDarkMode ? DarkTheme : LightTheme}>\n//   <Head>\n//     <link\n//       href=\"https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css\"\n//       rel=\"stylesheet\"\n//     />\n//   </Head>\n//   <AuthProvider>\n//     <Component cookies={cookies} {...pageProps} />\n//   </AuthProvider>\n//   <GlobalStyle></GlobalStyle>\n// </ThemeProvider>\n//   );\n// }\n// // MyApp.getInitialProps = ctx => ({\n// //   ctx: nextCookies(ctx)\n// // });\n\nconst AuthContext = /*#__PURE__*/React.createContext();\n\nfunction useAuthState() {\n  const state = React.useContext(AuthContext);\n  const isPending = state.status === \"pending\";\n  const isSuccess = state.status === \"success\";\n  const user = state.user;\n  const isAuthenticated = isSuccess;\n  return _objectSpread(_objectSpread({}, state), {}, {\n    isPending,\n    isSuccess,\n    isAuthenticated\n  });\n}\n\nfunction AuthContextProvider({\n  children\n}) {\n  const [cookies, setCookie] = useCookies();\n  const [state, setState] = React.useState({});\n  const [loading, setLoading] = React.useState(true);\n  let currentTime = Date.now() / 1000;\n  let access_token = cookies.access_token;\n  let expires_at = cookies.expires_at;\n  let refresh_token = cookies.refresh_token;\n  React.useEffect(() => {\n    setState({\n      cookies: cookies,\n      status: \"pending\"\n    });\n    let athleteFetchUrl = \"https://www.strava.com/api/v3/athlete\";\n\n    if (access_token && expires_at > currentTime) {\n      asyncFetch(athleteFetchUrl, cookies.access_token).then(data => {\n        return data.json();\n      }).then(user => {\n        setState({\n          user: user,\n          status: \"success\",\n          cookies: cookies\n        });\n      });\n    } else {\n      setState({\n        user: null,\n        status: \"error\",\n        cookies: cookies\n      });\n    }\n  }, [cookies]);\n  return __jsx(AuthContext.Provider, {\n    value: state\n  }, children);\n}\n\nfunction Home({\n  Component,\n  pageProps\n}) {\n  const {\n    isSuccess,\n    isPending\n  } = useAuthState();\n  const router = useRouter();\n  let isHandleRedirect = router.route == \"/handle_redirect\";\n  React.useEffect(() => {\n    console.log(isSuccess);\n  }, [isSuccess]);\n\n  if (isSuccess) {\n    return __jsx(AuthenticatedApp, null, __jsx(Component, pageProps));\n  } else if (isPending) {\n    return __jsx(Loading, null);\n  } else if (isHandleRedirect) {\n    return __jsx(HandleRedirect, null);\n  } else {\n    return __jsx(About, null);\n  }\n}\n\nconst LoadingScreen = styled.div.withConfig({\n  displayName: \"_app__LoadingScreen\",\n  componentId: \"sc-4kid5d-0\"\n})([\"position:absolute;top:0;right:0;left:0;bottom:0;display:flex;justify-content:center;align-items:center;p{}\"]);\n\nfunction Loading() {\n  return __jsx(LoadingScreen, null, __jsx(\"p\", null, \"Loading...\"));\n}\n\nfunction MyApp({\n  Component,\n  pageProps\n}) {\n  return __jsx(AuthContextProvider, null, __jsx(Home, {\n    Component: Component,\n    pageProps: pageProps\n  }));\n}\n\nexport default MyApp;\nexport { AuthContext, useAuthState };","map":null,"metadata":{},"sourceType":"module"}